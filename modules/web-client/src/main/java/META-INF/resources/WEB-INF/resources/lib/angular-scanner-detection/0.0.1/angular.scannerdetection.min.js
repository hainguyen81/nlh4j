'use strict';(function(){var module;module=angular.module("scanner.detection",[]);module.controller('ngScannerDetectController',['$scope',function($scope){var firstCharTime=0,lastCharTime=0,callIsScanner=!1,testTimer=!1,scanButtonCounter=0;$scope.onKeyDown=function(e){if($scope.options.scanButtonKeyCode!==!1&&e.which==$scope.options.scanButtonKeyCode){scanButtonCounter++;e.preventDefault();e.stopImmediatePropagation()}
else if((firstCharTime&&$scope.options.endChar.indexOf(e.which)!==-1)||(!firstCharTime&&$scope.options.startChar.indexOf(e.which)!==-1)){$scope.onKeyPress(e);e.preventDefault();e.stopImmediatePropagation()}};$scope.onKeyPress=function(e){if($scope.options.stopPropagation)e.stopImmediatePropagation();if($scope.options.preventDefault)e.preventDefault();if(firstCharTime&&$scope.options.endChar.indexOf(e.which)!==-1){e.preventDefault();e.stopImmediatePropagation();callIsScanner=!0}else if(!firstCharTime&&$scope.options.startChar.indexOf(e.which)!==-1){e.preventDefault();e.stopImmediatePropagation();callIsScanner=!1}else{if(typeof(e.which)!='undefined'){$scope.options.model+=String.fromCharCode(e.which)}
callIsScanner=!1}
if(!firstCharTime){firstCharTime=Date.now()}
lastCharTime=Date.now();if(testTimer)clearTimeout(testTimer);if(callIsScanner){scannerDetectionTest();testTimer=!1}
if($scope.options.onReceive)$scope.options.onReceive(e)};var scannerDetection=function(options){var defaults={onComplete:!1,onError:!1,onReceive:!1,onKeyDetect:!1,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,endChar:[9,13],startChar:[],ignoreIfFocusOn:!1,scanButtonKeyCode:!1,scanButtonLongPressThreshold:3,onScanButtonLongPressed:!1,stopPropagation:!1,preventDefault:!1};if(typeof options==="function"){options={onComplete:options}}
if(typeof options!=="object"){options=$.extend({},defaults)}else{options=$.extend({},defaults,options)}
return options};var scannerDetectionTest=function(){if(!scanButtonCounter){scanButtonCounter=1}
if($scope.options.model.length>=$scope.options.minLength&&lastCharTime-firstCharTime<$scope.options.model.length*$scope.options.avgTimeByChar){if($scope.options.onScanButtonLongPressed&&scanButtonCounter>$scope.options.scanButtonLongPressThreshold){$scope.options.onScanButtonLongPressed()}else if($scope.options.onComplete){$scope.options.onComplete()}
initScannerDetection();return!0}else{if($scope.options.onError)$scope.options.onError();initScannerDetection();return!1}};var init=function(){$scope.options=scannerDetection($scope.ngScannerDetect);initScannerDetection()};var initScannerDetection=function(){firstCharTime=0;scanButtonCounter=0};init()}]);module.directive('ngScannerDetect',function(){return{restrict:'A',scope:{ngScannerDetect:'='},controller:'ngScannerDetectController',link:function(scope,elm,attrs){elm.bind('keypress',function(e){scope.onKeyPress(e)});elm.bind('keydown',function(e){scope.onKeyDown(e)})}}})}).call(this)